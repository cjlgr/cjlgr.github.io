/*! medic 2017-10-12 */
var audioplayer={muteMusic:!1,sounds:{},music:{1:"assets/audio/track1.mp3"},currentMusic:null,preload:function(a){a.load.audio("fungi",["assets/audio/s1.mp3","assets/audio/bodenstaendig_2000_in_rock_4bit.ogg"]),a.load.audio("track1",["assets/audio/track1.mp3","assets/audio/bodenstaendig_2000_in_rock_4bit.ogg"])},init:function(a){this.sounds.fungi=a.add.audio("fungi"),this.music.track1=a.add.audio("track1")},play:function(a){this.sounds[a]||console.warn("Could not find audio for "+a)},playMusic:function(a,b){var c=this.music.track1;this.muteMusic||(b===!1?c.loopFull():"number"==typeof b?c.fadeIn(b,!0):c.fadeIn(3e3,!0),this.currentMusic=c)},stopMusic:function(a){a===!1?this.currentMusic.stop():"number"==typeof a?this.currentMusic.fadeOut(a):this.currentMusic.fadeOut(3e3)}};BasicGame={score:0,music:null,orientated:!1},BasicGame.Boot=function(a){},BasicGame.Boot.prototype={init:function(){var a=Utils.ScreenUtils.screenMetrics;this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.scaleMode=Phaser.ScaleManager.USER_SCALE,this.scale.setUserScale(a.scaleX,a.scaleY),this.game.device.desktop||(this.scale.forceOrientation(!0,!1),this.scale.setResizeCallback(this.gameResized,this),this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this))},preload:function(){this.load.image("loadscreen1","assets/images/loadscreen1.png"),this.load.image("preloaderBar","assets/images/preloader_bar.png")},create:function(){this.state.start("Preloader")},gameResized:function(a,b){},enterIncorrectOrientation:function(){BasicGame.orientated=!1,document.getElementById("orientation").style.display="block"},leaveIncorrectOrientation:function(){BasicGame.orientated=!0,document.getElementById("orientation").style.display="none"}};var enemylib=enemylib||{flu:{name:"Flu",type:"disease",damage:14,damageVariation:5,sprite:"",lives:100,livesVariation:3,enemySprite:"enemy1"},cold:{name:"Cold",type:"disease",damage:5,damageVariation:2,sprite:"",lives:90,livesVariation:1,enemySprite:"enemy-common-cold"},stabWound:{name:"Stab wound",type:"wound",damage:20,damageVariation:6,sprite:"",lives:110,livesVariation:20,enemySprite:"enemy-stab-wound"}},gameSession=gameSession||{sprites:{},spawnOptions:{},currentLevel:"123"},pickupLog=pickupLog||{},progressLog=progressLog||{destroyedSprites:[],revealedSprites:[],graves:[],addGrave:function(a){this.graves.push(a)},addDestroyedSprite:function(a){var b=this.destroyedSprites.indexOf(a);b===-1&&this.destroyedSprites.push(a);var b=this.revealedSprites.indexOf(a);b>-1&&this.revealedSprites.splice(b,1)},addRevealedSprite:function(a){var b=this.revealedSprites.indexOf(a);b===-1&&this.revealedSprites.push(a);var b=this.destroyedSprites.indexOf(a);b>-1&&this.destroyedSprites.splice(b,1)},isDestroyed:function(a){var b=this.destroyedSprites.indexOf(a);return b>-1},isRevealed:function(a){var b=this.revealedSprites.indexOf(a);return b>-1}};BasicGame.Game=function(a){this.game,this.add,this.camera,this.cache,this.input,this.load,this.math,this.sound,this.stage,this.time,this.tweens,this.world,this.particles,this.physics,this.rnd,medicmenu.eventHub.$on("save",function(){var a={progressLog:{graves:progressLog.graves,revealedSprites:progressLog.revealedSprites,destroyedSprites:progressLog.destroyedSprites},currentLevel:gameSession.currentLevel,pickupLog:pickupLog,score:brew.scoreStore.getters.score,items:brew.itemStore.getters.allItems,recipes:brew.recipeStore.getters.allRecipes,playerHitAreaX:gameSession.sprites.playerHitArea.body.x,playerHitAreaY:gameSession.sprites.playerHitArea.body.y},b=btoa(JSON.stringify(a));localStorage.setItem("medic-save",b),console.log("Game saved")}.bind(this)),brew.eventHub.$on("showGrave",function(a){for(var b,c=gameSession.sprites.patients.children,d=0;d<c.length;d++)c[d].extraProps.tid===a&&(b={x:c[d].x,y:c[d].y,patientTid:a,level:gameSession.currentLevel},progressLog.addGrave(b),this.createGrave(b))}.bind(this)),brew.eventHub.$on("hideSprite",function(a){var b=["blockers","patients","pickups","persons","ladders","platforms"],c="";progressLog.addDestroyedSprite(a);for(var d=0;d<b.length;d++){var c=gameSession.sprites[b[d]];if(c&&c.children.length)for(var e=0;e<c.children.length;e++)c.children[e].extraProps&&c.children[e].extraProps.tid===a&&(c.children[e].visible=!1,c.children[e].body&&(c.children[e].body.enable=!1))}}),brew.eventHub.$on("revealSprite",function(a){var b=["blockers","patients","pickups","persons","ladders","platforms"],c="";progressLog.addRevealedSprite(a);for(var d=0;d<b.length;d++){var c=gameSession.sprites[b[d]];if(c&&c.children.length)for(var e=0;e<c.children.length;e++)c.children[e].extraProps&&c.children[e].extraProps.tid===a&&(c.children[e].visible=!0,c.children[e].body&&(c.children[e].body.enable=!0))}})},BasicGame.Game.prototype={init:function(a){var b={direction:"right",position:"left"};localStorage.getItem("medic-levels")?(console.warn("Using level data from local storage"),levels=JSON.parse(localStorage.getItem("medic-levels"))):console.warn("Using level data from file"),a&&(a.resuming?(gameSession.currentLevel=a.level,b.resuming=!0,b.x=a.x,b.y=a.y):(b.direction=a.direction,b.position=a.position,gameSession.currentLevel=a.level,b.spawnAtSprite=a.spawnAtSprite)),gameSession.spawnOptions=b,console.log("entering level: "+gameSession.currentLevel+" with options",b)},create:function(a){for(var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=0;r<levels.length;r++)levels[r].levelId===gameSession.currentLevel&&(q=levels[r]);if(a.world.setBounds(0,0,Utils.ScreenUtils.screenMetrics.maxGameWidth,Utils.ScreenUtils.screenMetrics.maxGameHeight),b=this.add.sprite(this.world.centerX,this.world.centerY,q.bgSprite),b.anchor.setTo(.5,.5),a.stage.backgroundColor="#444444",b.width=Utils.ScreenUtils.screenMetrics.maxGameWidth,b.height=Utils.ScreenUtils.screenMetrics.maxGameHeight,q.bgs&&q.bgs.length){bgs=gameSession.sprites.bgs=a.add.group();for(var r=0;r<q.bgs.length;r++)var s=q.bgs[r].sprite,b=bgs.create(q.bgs[r].x,q.bgs[r].y,s)}if(q.ladders&&q.ladders.length){h=gameSession.sprites.ladders=a.add.group();for(var r=0;r<q.ladders.length;r++){var t=q.ladders[r].sprite,u=h.create(q.ladders[r].x,q.ladders[r].y,t);u.anchor.setTo(0,0),u.extraProps={direction:q.ladders[r].direction,tid:q.ladders[r].tid},q.ladders[r].hidden&&!progressLog.isRevealed(q.ladders[r].tid)&&(u.visible=!1),progressLog.isDestroyed(q.ladders[r].tid)&&(u.visible=!1)}}if(q.savepoints&&q.savepoints.length){o=gameSession.sprites.savepoints=a.add.group();for(var r=0;r<q.savepoints.length;r++){var v=q.savepoints[r].sprite;o.create(q.savepoints[r].x,q.savepoints[r].y,v)}}if(q.persons&&q.persons.length){l=gameSession.sprites.persons=a.add.physicsGroup();for(var r=0;r<q.persons.length;r++){var w=q.persons[r].sprite,x=l.create(q.persons[r].x,q.persons[r].y,w);x.anchor.setTo(0,0),x.extraProps={questMessage:q.persons[r].questMessage,thankYouMessage:q.persons[r].thankYouMessage,tid:q.persons[r].tid,revives:q.persons[r].revives},x.inputEnabled=!0,q.persons[r].hidden&&!progressLog.isRevealed(q.persons[r].tid)&&(x.visible=!1,x.body.enable=!1),progressLog.isDestroyed(q.persons[r].tid)&&(x.visible=!1,x.body.enable=!1),x.events.onInputDown.add(function(a){},this)}}if(q.platforms&&q.platforms.length){i=gameSession.sprites.platforms=a.add.physicsGroup();for(var r=0;r<q.platforms.length;r++){var y=q.platforms[r].sprite,z=i.create(q.platforms[r].x,q.platforms[r].y,y);z.body.checkCollision.down=!1,z.body.checkCollision.left=!1,z.body.checkCollision.right=!1,z.extraProps={tid:q.platforms[r].tid},q.platforms[r].hidden&&!progressLog.isRevealed(q.platforms[r].tid)&&(z.visible=!1,z.body.enable=!1),progressLog.isDestroyed(q.platforms[r].tid)&&(z.visible=!1,z.body.enable=!1)}i.setAll("body.immovable",!0)}for(var A=(gameSession.sprites.graves=a.add.physicsGroup(),0);A<progressLog.graves.length;A++)this.createGrave(progressLog.graves[A]);if(q.groundY||0===q.groundY){var B=gameSession.sprites.grounds=a.add.physicsGroup();if(!q.noGround){var C=q.groundSprite,f=B.create(0,parseInt(q.groundY,10),C);f.body.checkCollision.down=!1}}if(B.setAll("body.immovable",!0),q.blockers&&q.blockers.length){n=gameSession.sprites.blockers=a.add.physicsGroup();for(var r=0;r<q.blockers.length;r++){var D=q.blockers[r].sprite,E=n.create(q.blockers[r].x,q.blockers[r].y,D);E.anchor.setTo(0,0),E.extraProps={tid:q.blockers[r].tid},q.blockers[r].hidden&&!progressLog.isRevealed(q.blockers[r].tid)&&(E.visible=!1,E.body.enable=!1),progressLog.isDestroyed(q.blockers[r].tid)&&(E.visible=!1,E.body.enable=!1)}n.setAll("body.immovable",!0)}if(q.slopes&&q.slopes.length){p=gameSession.sprites.slopes=a.add.physicsGroup();for(var r=0;r<q.slopes.length;r++){var F=q.slopes[r].sprite,G=p.create(q.slopes[r].x,q.slopes[r].y,F),H=q.slopes[r].slopeSize;H&&(G.height=H,G.width=H),G.extraProps={tid:q.slopes[r].tid,direction:q.slopes[r].slopeDirection},q.slopes[r].hidden&&!progressLog.isRevealed(q.slopes[r].tid)&&(G.visible=!1,G.body.enable=!1),progressLog.isDestroyed(q.slopes[r].tid)&&(G.visible=!1,G.body.enable=!1)}p.setAll("body.immovable",!0)}if(q.portals&&q.portals.length){g=gameSession.sprites.portals=a.add.physicsGroup();for(var r=0;r<q.portals.length;r++){var I=q.portals[r].x,J=q.portals[r].y,K=q.portals[r].leads,L=q.portals[r].offset,M=q.portals[r].stretch,N=150,O=100,P=q.portals[r].door;spawnAtSprite=q.portals[r].spawnAtSprite,L&&("up"===K&&(J-=N),"down"===K&&(J+=N),"left"===K&&(I-=O),"right"===K&&(I+=O));var Q=g.create(I,J,"portal");Q.alpha=0,Q.anchor.setTo(0,0),Q.extraProps={type:q.portals[r].type,leads:K,level:q.portals[r].levelId,isDoor:P,spawnAtSprite:spawnAtSprite},P&&(Q.body.checkCollision.none=!0),M&&("up"!==K&&"down"!==K||(Q.width=3e3),"left"!==K&&"right"!==K||(Q.height=2e3))}g.setAll("body.immovable",!0)}if(q.pickups&&q.pickups.length){k=gameSession.sprites.pickups=a.add.physicsGroup();for(var r=0;r<q.pickups.length;r++){var R,S={},T=q.pickups[r].tid,U=(new Date).getTime(),V=!1,W={};itemlib[q.pickups[r].type]&&(R=q.pickups[r].spawnTime||0,R=parseInt(R,10),pickupLog[T]?R===-1?V=!1:U-pickupLog[T]>1e3*R&&(V=!0):V=!0,V&&(S=JSON.parse(JSON.stringify(itemlib[q.pickups[r].type])),S.tid=q.pickups[r].tid,W=k.create(parseInt(q.pickups[r].x,10),parseInt(q.pickups[r].y,10),S.sprite),W.extraProps=S,W.anchor.setTo(0,0),q.pickups[r].hidden&&!progressLog.isRevealed(q.pickups[r].tid)&&(W.visible=!1,W.body.enable=!1),progressLog.isDestroyed(q.pickups[r].tid)&&(W.visible=!1,W.body.enable=!1)))}}if(gameSession.spawnOptions.resuming)d=gameSession.spawnOptions.x,e=gameSession.spawnOptions.y+100;else if(gameSession.spawnOptions.spawnAtSprite)for(var r=0;r<q.portals.length;r++)gameSession.spawnOptions.spawnAtSprite===q.portals[r].tid&&(d=q.portals[r].x,e=q.portals[r].y+100);else{if(q.noGround){if(gameSession.sprites.platforms.length){var X=gameSession.sprites.platforms.children.map(function(a){return a});X.sort(function(a,b){return a.x-b.x}),"left"===gameSession.spawnOptions.position&&(d=X[0].x+50,e=X[0].y),"right"===gameSession.spawnOptions.position&&(d=X[X.length-1].x+X[X.length-1].width-50,e=X[X.length-1].y)}}else"left"===gameSession.spawnOptions.position&&(d=5,e=parseInt(q.groundY,10)),"right"===gameSession.spawnOptions.position&&(d=Utils.ScreenUtils.screenMetrics.gameWidth-5,e=parseInt(q.groundY,10));if("bottom"===gameSession.spawnOptions.position){for(var r=0;r<h.children.length;r++)"down"===h.children[r].extraProps.direction&&(j=h.children[r]);d=j?parseInt(j.x,10):100,e=Utils.ScreenUtils.screenMetrics.gameHeight+40}if("top"===gameSession.spawnOptions.position){for(var r=0;r<h.children.length;r++)"up"===h.children[r].extraProps.direction&&(j=h.children[r]);d=j?j.x:100,e=100}}if(c=gameSession.sprites.player=a.add.sprite(d,e,"player"),c.animations.add("walk",[1,2,3,4,5],20,!0),console.log("Player spawned at",d,e),c.anchor.setTo(.5,1),playerHitArea=gameSession.sprites.playerHitArea=a.add.sprite(d-4,e,"playerHitArea"),playerHitArea.anchor.setTo(.5,1),playerHitArea.alpha=0,a.physics.arcade.enable(c),a.physics.arcade.enable(playerHitArea),playerHitArea.body.gravity.y=3e3,a.camera.follow(c),q.patients&&q.patients.length){m=gameSession.sprites.patients=a.add.physicsGroup();for(var r=0;r<q.patients.length;r++){var Y=q.patients[r].sprite,Z=m.create(q.patients[r].x,q.patients[r].y,Y);Z.anchor.setTo(0,0),Z.extraProps={sprite:q.patients[r].sprite,enemy:q.patients[r].enemy,lives:q.patients[r].lives,saveMessage:q.patients[r].saveMessage,reward:q.patients[r].reward,rewardQty:q.patients[r].rewardQty,revealTid:q.patients[r].revealTid,hideTid:q.patients[r].hideTid,tid:q.patients[r].tid},Z.inputEnabled=!0,q.patients[r].hidden&&!progressLog.isRevealed(q.patients[r].tid)&&(Z.visible=!1,Z.body.enable=!1),progressLog.isDestroyed(q.patients[r].tid)&&(Z.visible=!1,Z.body.enable=!1),Z.events.onInputDown.add(function(a){this.checkOverlap(gameSession.sprites.player,a)&&brew.eventHub.$emit("startBattle",a.extraProps)},this)}}cursors=a.input.keyboard.createCursorKeys(),jumpButton=a.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR)},createGrave:function(a){if(a.level===gameSession.currentLevel){var b=gameSession.sprites.graves.create(a.x,a.y,"grave");b.extraProps={patientTid:a.patientTid},b.anchor.setTo(.5,.5)}},update:function(a){var b=this,c=gameSession.sprites.player,d=gameSession.sprites.playerHitArea,e=gameSession.sprites.grounds,f=gameSession.sprites.portals,g=gameSession.sprites.pickups,h=gameSession.sprites.platforms,i=gameSession.sprites.ladders,j=(gameSession.sprites.persons,gameSession.sprites.blockers),k=(gameSession.sprites.savepoints,gameSession.sprites.slopes);a.physics.arcade.collide(d,e),a.physics.arcade.collide(d,g,this.onPickupCollision,null,a),a.physics.arcade.collide(d,h),a.physics.arcade.collide(d,j),a.physics.arcade.collide(d,f,this.onPortalCollision,null,a),d.body.velocity.x=0,this.checkGroupOverlap(d,i).overlaps?(d.body.allowGravity=!1,d.body.velocity.y=0):d.body.allowGravity=!0;var l=this.checkGroupOverlap(d,k),m=d.body.y;if(l.overlaps){var n=d.body.y+d.body.height>l.sprite.y;if(n){var o=0;"upRight"===l.sprite.extraProps.direction?(o=Math.ceil(c.body.x+c.body.width/2-l.sprite.x),o=Math.max(o,0),o=Math.min(o,l.sprite.width-1)):"upLeft"===l.sprite.extraProps.direction?(o=l.sprite.width-Math.ceil(c.body.x+c.body.width/2-l.sprite.x),o=Math.max(o,0),o=Math.min(o,l.sprite.width-1)):console.warn("Slope missing direction",l.sprite.extraProps);var p=l.sprite.y+l.sprite.height-d.body.height-o;p>m-10&&(d.body.y=p),d.body.gravity.y=0}}else d.body.gravity.y=3e3;b.handleTouchInput(a),b.handleKeyboardInput(),c.y=d.y,c.x=d.x,0===d.body.velocity.x&&(c.animations.stop("walk"),c.animations.frame=5)},movePlayer:function(a){var b=gameSession.sprites.player,c=gameSession.sprites.playerHitArea,d=gameSession.sprites.ladders;gameSession.sprites.slopes;switch(a){case"up":this.checkGroupOverlap(c,d).overlaps&&(c.body.velocity.y=-250);break;case"down":this.checkGroupOverlap(c,d).overlaps&&(c.body.velocity.y=250);break;case"left":c.body.velocity.x=-250,b.play("walk"),b.scale.x>0&&(b.scale.x=-1);break;case"right":c.body.velocity.x=250,b.play("walk"),b.scale.x<0&&(b.scale.x=1)}},handleTouchInput:function(a){var b,a=me=this,c=(a.input.activePointer,a.input.pointer1),d=a.input.mousePointer,e=Utils.ScreenUtils.screenMetrics.gameWidth,f=Utils.ScreenUtils.screenMetrics.gameHeight;(d.isDown||c.isDown)&&(d.isDown&&(d.x<e/3?b="left":d.x>e/3*2?b="right":d.y<f/3?b="up":d.y>f/3*2&&(b="down")),c.isDown&&(c.x<e/3?b="left":c.x>e/3*2?b="right":c.y<f/3?b="up":c.y>f/3*2&&(b="down")),me.handleKeyboardInput(b))},handleKeyboardInput:function(a){var b;gameSession.sprites.player;if(cursors.left.isDown&&!cursors.right.isDown||"left"===a){if(b=document.getElementsByClassName("window"),b&&b.length)return;this.movePlayer("left")}else if(cursors.right.isDown&&!cursors.left.isDown||"right"===a){if(b=document.getElementsByClassName("window"),b&&b.length)return;this.movePlayer("right")}else if(cursors.up.isDown&&!cursors.down.isDown||"up"===a){if(b=document.getElementsByClassName("window"),b&&b.length)return;overlapresultPortals=this.checkGroupOverlap(gameSession.sprites.player,gameSession.sprites.portals),overlapresultPortals.overlaps?overlapresultPortals.sprite&&overlapresultPortals.sprite.extraProps&&overlapresultPortals.sprite.extraProps.isDoor&&this.onPortalCollision(gameSession.sprites.player,overlapresultPortals.sprite):this.movePlayer("up")}else if(cursors.down.isDown&&!cursors.up.isDown||"down"===a){if(b=document.getElementsByClassName("window"),b&&b.length)return;if(overlapResultPatient=this.checkGroupOverlap(gameSession.sprites.player,gameSession.sprites.patients),overlapResultPerson=this.checkGroupOverlap(gameSession.sprites.player,gameSession.sprites.persons),overlapResultGrave=this.checkGroupOverlap(gameSession.sprites.player,gameSession.sprites.graves),overlapResultSavePoint=this.checkGroupOverlap(gameSession.sprites.player,gameSession.sprites.savepoints),overlapResultPatient.overlaps)brew.eventHub.$emit("startBattle",overlapResultPatient.sprite.extraProps);else if(overlapResultPerson.overlaps)if(progressLog.graves.length>0){var c,d,e=overlapResultPerson.sprite.extraProps.revives;if(e){if(1===brew.scoreStore.getters.score.life)return void(localStorage.getItem("medic-save")?brew.eventHub.$emit("displayMessage",{msgHeader:"You failed",msg:"You failed. Restart?",closeCallback:function(a){medicmenu.eventHub.$emit("continue")}}):brew.eventHub.$emit("displayMessage",{msgHeader:"You failed",msg:"Game over. Now leave this land.",scope:this,closeCallback:function(a){this.gameOver()}}));c=e.split(","),brew.eventHub.$emit("displayMessage",{msgHeader:"",msg:"You have failed. I will revive the one who slumbers, but I will need a sacrifice. It will cost you some life.",closeCallback:function(a){brew.eventHub.$emit("decreaseLife",1)}});for(var f=progressLog.graves.length-1;f>=0;f--){d=progressLog.graves[f].patientTid;for(var g=0;g<c.length;g++)if(d===c[g]){brew.eventHub.$emit("revealSprite",d);for(var h=gameSession.sprites.graves.children.length-1;h>=0;h--)gameSession.sprites.graves.children[h].extraProps.patientTid===d&&gameSession.sprites.graves.children[h].destroy();progressLog.graves.splice(f,1)}}}progressLog.graves=[]}else brew.eventHub.$emit("displayMessage",{msg:overlapResultPerson.sprite.extraProps.questMessage});else overlapResultGrave.overlaps?brew.eventHub.$emit("displayMessage",{msgHeader:"The grave stone reads:",msg:"The one who slumbers does not sleep.<br> The one who can awaken <i>is awaiting your sacrifice</i>."}):overlapResultSavePoint.overlaps?brew.eventHub.$emit("displayMessage",{msgHeader:"Statue Of Our Saviour",msg:'The plaque reads:<br>"Bear true allegiance to our Saviour and your spirit shall be engraved in the memory of this land 4-ever."',scope:this,buttons:["CANCEL","SAVE"],closeCallback:function(a){"SAVE"===a&&(medicmenu.eventHub.$emit("save"),brew.eventHub.$emit("displayMessage",{msgHeader:"Game saved",msg:"The game has been saved"}))}}):this.movePlayer("down")}},onPickupCollision:function(a,b){var c=b.extraProps;c.type+"s";console.log("Picked up a "+c.name),brew.eventHub.$emit("addItem",{id:c.id,qty:1}),pickupLog[c.tid]=(new Date).getTime(),b.kill(),audioplayer.play(c.category)},onPortalCollision:function(a,b){var c={};b.extraProps&&("right"===b.extraProps.leads&&(c={level:b.extraProps.level,direction:"right",position:"left"}),"left"===b.extraProps.leads&&(c={level:b.extraProps.level,direction:"left",position:"right"}),"up"===b.extraProps.leads&&(c={level:b.extraProps.level,direction:"up",position:"bottom"}),"down"===b.extraProps.leads&&(c={level:b.extraProps.level,direction:"down",position:"top"}),b.extraProps.spawnAtSprite&&(c.spawnAtSprite=b.extraProps.spawnAtSprite)),this.state.start(this.state.current,!0,!1,c)},checkOverlap:function(a,b){var c=a.getBounds(),d=b.getBounds();return Phaser.Rectangle.intersects(c,d)},checkGroupOverlap:function(a,b){var c={};if(!a||!b)return!1;for(var d=!1,e=a.getBounds(),f=(b.children.map(function(a){return a.getBounds()}),0);f<b.children.length;f++)Phaser.Rectangle.intersects(e,b.children[f].getBounds())&&b.children[f].visible&&(d=!0,c=b.children[f]);return{overlaps:d,sprite:c}},quitGame:function(a){this.state.start("MainMenu")},gameOver:function(){brew.eventHub.$emit("hideTopMenu"),medicmenu.eventHub.$emit("showMainMenu"),this.state.start("MainMenu")}},itemlib={mushroom:{type:"material",category:"fungi",sprite:"mushroom",id:"mushroom",name:"Mushroom",qty:0,props:[{prop:"flu",strength:-200,name:"Flu"},{prop:"cold",strength:40,name:"Cold"},{prop:"darkness",strength:30,name:"Darkness"}],fortifies:[{prop:"cold",factor:1.5,name:"Cold"}],spawntime:null},flyAgaric:{type:"material",category:"fungi",sprite:"flyAgaric",id:"flyAgaric",name:"Fly agaric",qty:0,props:[{prop:"goodLuck",strength:100,name:"Good luck"},{prop:"bites",strength:100,name:"Snake & insect bites"},{prop:"insects",strength:100,name:"Insects"}],fortifies:[{prop:"insects",factor:3,name:"Insects"},{prop:"bites",factor:2,name:"Snake & insect bites"}],spawntime:null},bearbile:{type:"material",category:"animalia",sprite:"bearbile",name:"Bear bile",id:"bearbile",qty:0,props:[{prop:"wound",strength:50,name:"Wounds"},{prop:"sickness",strength:40,name:"Sickness"},{prop:"flu",strength:40,name:"Flu"}],fortifies:[{prop:"sickness",factor:1.5,name:"Sickness"},{prop:"flu",factor:1.5,name:"Flu"},{prop:"wound",factor:2,name:"Wounds"}],spawntime:null},batsBlood:{type:"material",category:"animalia",sprite:"batsBlood",name:"Bats blood",id:"batsBlood",qty:0,props:[{prop:"eyeDisease",strength:200,name:"Eye disease"}],fortifies:[{prop:"eyeDisease",factor:1.5,name:"Eye disease"}],spawntime:null},dragonsBlood:{type:"material",category:"animalia",sprite:"dragonsBlood",name:"Dragons blood",id:"dragonsBlood",qty:0,props:[{prop:"disease",strength:230,name:"Disease"}],fortifies:[{prop:"disease",factor:2,name:"Disease"}],spawntime:null},duck:{type:"material",category:"animalia",sprite:"duck",name:"Duck",id:"duck",qty:0,props:[{prop:"disease",strength:100,name:"Disease"}],spawntime:null},giantCentipede:{type:"material",category:"animalia",sprite:"giantCentipede",name:"Giant centipede",id:"giantCentipede",qty:0,props:[{prop:"evil",strength:150,name:"Evil"}],spawntime:null},batsEyes:{type:"material",category:"animalia",sprite:"batsEyes",name:"Bats eyes",id:"batsEyes",qty:0,props:[{prop:"invisibility",strength:150,name:"Invisibility"}],spawntime:null},bearPaw:{type:"material",category:"animalia",sprite:"bearPaw",name:"Dried bear paw",id:"bearPaw",qty:0,props:[{prop:"pain",strength:100,name:"Pain"}],spawntime:null},owlClaw:{type:"material",category:"animalia",sprite:"owlClaw",name:"Owl claw",id:"owlClaw",qty:0,props:[{prop:"goodLuck",strength:100,name:"Good luck"}],spawntime:null},ravenGall:{type:"material",category:"animalia",sprite:"ravenGall",name:"Raven Gall",id:"ravenGall",qty:0,props:[{prop:"blackMagic",strength:100,name:"Black magic"},{prop:"dispelDarkness",strength:100,name:"Dispel darkness"},{prop:"evil",strength:100,name:"Evil"}],spawntime:null},snail:{type:"material",category:"animalia",sprite:"snail",name:"Snail",id:"snail",qty:0,props:[{prop:"eyeDisease",strength:100,name:"Eye disease"},{prop:"cough",strength:100,name:"Cough"}],spawntime:null},amethyst:{type:"material",category:"mineral",sprite:"amethyst",name:"Amethyst",id:"amethyst",qty:0,props:[{prop:"memory",strength:50,name:"Memory"}],fortifies:[{prop:"memory",factor:1.5,name:"Memory"}],spawntime:null},amberCalcite:{type:"material",category:"mineral",sprite:"amberCalcite",name:"Amber calcite",id:"amberCalcite",qty:0,props:[{prop:"memory",strength:70,name:"Memory"}],spawntime:null},blackTourmaline:{type:"material",category:"mineral",sprite:"blackTourmaline",name:"Black tourmaline",id:"blackTourmaline",qty:0,props:[{prop:"blackMagic",strength:100,name:"Black magic"}],fortifies:[{prop:"blackMagic",factor:3,name:"Black magic"}],spawntime:null},plant:{type:"material",category:"plantae",sprite:"plant",name:"Rosemary",id:"plant",qty:0,props:[{prop:"flu",strength:5,name:"Flu"},{prop:"cold",strength:10,name:"Cold"},{prop:"cough",strength:30,name:"Cough"}],fortifies:[{prop:"cold",factor:1.5,name:"Cold"}],spawntime:null},heather:{type:"material",category:"plantae",sprite:"heather",name:"Heather",id:"heather",qty:0,props:[{prop:"goodLuck",strength:100,name:"Good luck"}],fortifies:[{prop:"goodLuck",factor:2,name:"Good luck"}]},falseUnicornRoot:{type:"material",category:"plantae",sprite:"falseUnicornRoot",name:"False unicorn root",id:"falseUnicornRoot",qty:0,props:[{prop:"dispelDarkness",strength:100,name:"Dispel darkness"},{prop:"evil",strength:100,name:"Evil"}],fortifies:[{prop:"evil",factor:1.5,name:"Evil"}]},chamomile:{type:"material",category:"plantae",sprite:"chamomile",name:"Chamomile",id:"chamomile",qty:0,props:[{prop:"Insomnia",strength:100,name:"Insomnia"}]},foxglove:{type:"material",category:"plantae",sprite:"foxglove",name:"Foxglove",id:"foxglove",qty:0,props:[{prop:"heartDisease",strength:100,name:"Heart disease"}]},milkweed:{type:"material",category:"plantae",sprite:"milkweed",name:"Milkweed",id:"milkweed",qty:0,props:[{prop:"healWounds",strength:100,name:"Heal wounds"}]},oakBark:{type:"material",category:"plantae",sprite:"oarkBark",name:"Oak bark",id:"oakBark",qty:0,props:[{prop:"abdomenPain",strength:100,name:"Abdomen pain"},{prop:"disease",strength:100,name:"Disease"}]},peppermint:{type:"material",category:"plantae",sprite:"peppermint",name:"Peppermint",id:"peppermint",qty:0,props:[{prop:"flu",strength:100,name:"Flu"},{prop:"insects",strength:100,name:"Insects"}]},thyme:{type:"material",category:"plantae",sprite:"thyme",name:"Thyme",id:"thyme",qty:0,props:[{prop:"wound",strength:100,name:"Wounds"},{prop:"cough",strength:100,name:"Cough"},{prop:"insects",strength:100,name:"Insects"}]},figwort:{type:"material",category:"plantae",sprite:"figwort",name:"Figwort",id:"figwort",qty:0,props:[{prop:"wound",strength:100,name:"Wounds"},{prop:"burns",strength:100,name:"Burns"}]},dogRose:{type:"material",category:"plantae",sprite:"dogRose",name:"Dog rose",id:"dogRose",qty:0,props:[{prop:"insomnia",strength:100,name:"Insomnia"},{prop:"scurvy",strength:100,name:"Scurvy"}]}};var levels=[{groundY:550,groundSprite:"ground1",ladders:[{x:500,y:550,direction:"up",sprite:"ladder1"}],platforms:[{x:550,y:200,sprite:"platform1"}],portals:[{type:"path",level:0,x:"left",y:"ground"},{type:"path",level:1,x:"right",y:"ground"},{type:"ladder",level:2,x:500,y:"top"}],pickups:[{x:400,y:550,type:"mushroom"},{x:200,y:550,type:"amethyst"},{x:600,y:200,type:"amberCalcite"},{x:730,y:200,type:"blackTourmaline"},{x:450,y:550,type:"mushroom"},{x:650,y:550,type:"plant"},{x:1e3,y:550,type:"bearbile"}],persons:[{x:900,y:550,sprite:"witch1",questMessage:"- Young medic. Deep in these woods lives the rat bat. Rat bat has come down with a nasty flu. Quick! Do not hesitate! Rush there and help!",thankYouMessage:"- Thank you for helping rat bat. Order has finally been restored in these woods."}],patients:[{x:1100,y:578,sprite:"patient1",enemy:"flu",lives:20}]},{groundY:250,groundSprite:"ground1",ladders:[{x:700,y:250,direction:"up",sprite:"ladder1"},{x:100,y:250,direction:"up",sprite:"ladder1"}],platforms:[],portals:[{type:"path",level:0,x:"left",y:"ground"},{type:"path",level:1,x:"right",y:"ground"},{type:"ladder",level:2,x:100,y:"top"},{type:"ladder",level:2,x:700,y:"top"}]},{groundY:null,groundSprite:null,ladders:[{x:100,y:450,direction:"down",sprite:"ladder1"}],platforms:[],pickups:[{x:100,y:450,type:"mushroom"}],portals:[{type:"ladder",level:0,x:100,y:"bottom"}]}],levels=[{levelId:"123",groundY:"636",groundSprite:"ground1",bgSprite:"bg1b",levelName:"Startbana",ladders:[{tid:"1496177168737",x:594,y:-324,sprite:"ladder1",direction:"up",hidden:!1}],platforms:[{tid:"1498504715797",x:633,y:254,sprite:"platform1",levelId:"",hidden:!1}],portals:[{tid:"1496175875590",x:1360,y:537,sprite:"portal",level:"bana567",levelId:"456",leads:"right",offset:!0},{tid:"1496693812069",x:582,y:1,sprite:"portal",levelId:"1496427681086",leads:"up",offset:!0,stretch:!0},{tid:"1500237065908",x:432,y:539,sprite:"door",levelId:"1500237137016",door:!0,leads:"right",spawnAtSprite:"1500239015163"},{tid:"1500634570585",x:-1,y:533,sprite:"portal",levelId:"1500634511430",leads:"left",offset:!0,stretch:!0}],pickups:[{tid:"1494702838054",x:306,y:598,sprite:"mushroom",pickupType:"mushroom",spawnTime:"10",type:"mushroom"},{tid:"1496088467007",x:521,y:577,sprite:"bearbile",pickupType:"bearbile",spawnTime:"15",hidden:!1,type:"bearbile"},{tid:"1498504686345",x:710,y:219,sprite:"mushroom",levelId:"",pickupType:"mushroom",spawnTime:"30",hidden:!1,type:"mushroom"},{tid:"1500154864714",x:811,y:177,sprite:"dogRose",levelId:"",pickupType:"dogRose",spawnTime:"10",type:"dogRose"},{tid:"1500154894560",x:903,y:583,sprite:"thyme",levelId:"",pickupType:"thyme",spawnTime:"10",type:"thyme"},{tid:"1500154966593",x:1322,y:582,sprite:"peppermint",levelId:"",pickupType:"peppermint",spawnTime:"10",type:"peppermint"}],persons:[{tid:"1498844147012",x:338,y:557,sprite:"witch1",levelId:"",questMessage:"Traveller! You must save him! There is only so much I can do with spells. This man has come down with a nasty <b>flu</b>. He needs treatment, quick!",thankYouMessage:"Thank you Medic!",hidden:!1,revives:"1498500458042,1494702838054"}],patients:[{tid:"1498500458042",x:1e3,y:619,sprite:"patient1",levelId:"",lives:"30",enemy:"flu",saveMessage:"Thank you! You saved my life. Take this piece of <b>amber calcite</b> as a token of gratitude. May it help you in your quest.\n<br><br>\nI will also <i>remove this big boulder</i> for you.",reward:"amberCalcite",rewardQty:"3",revealTid:"",hideTid:"1499001335462",hidden:!1},{tid:"1500582495531",x:587,y:614,sprite:"patient4",levelId:"",lives:"10",enemy:"stabWound",saveMessage:"Thank you for saving me!"},{tid:"1505934892514",x:926,y:242,sprite:"patient5",levelId:"",lives:"200",enemy:"cold",saveMessage:"Thanks, you're my hero!",reward:"duck",rewardQty:"1"}],blockers:[{tid:"1499001335462",x:1099,y:416,sprite:"rock1",levelId:""}],slopes:[],bgs:[{tid:"1499003433945",x:2,y:424,sprite:"bush1",levelId:""},{tid:"1499004613672",x:211,y:497,sprite:"bush1",levelId:""},{tid:"1499004629208",x:446,y:452,sprite:"bush1",levelId:""},{tid:"1499004638231",x:623,y:552,sprite:"bush1",levelId:""},{tid:"1499004646207",x:832,y:337,sprite:"bush1",levelId:"",hidden:!1},{tid:"1499273399772",x:270,y:300,sprite:"tent1",levelId:""}]},{levelId:"456",groundY:"635",groundSprite:"ground1",bgSprite:"bg2",levelName:"Bana 2",ladders:[{tid:"1505935826496",x:207,y:235,sprite:"ladder1",levelId:""}],platforms:[{tid:"1496694171361",x:247,y:240,sprite:"platform1",levelId:""},{tid:"1496694197191",x:846,y:396,sprite:"platform1",levelId:""}],portals:[{tid:"1496694262835",x:1361,y:534,sprite:"portal",levelId:"123",leads:"right",offset:!0},{tid:"1497730087537",x:-1,y:537,sprite:"portal",levelId:"123",leads:"left",offset:!0,stretch:!0}],pickups:[{tid:"1496694236791",x:919,y:349,sprite:"blackTourmaline",levelId:"",pickupType:"blackTourmaline",spawnTime:"-1",type:"blackTourmaline"},{tid:"1499274380405",x:1234,y:578,sprite:"plant",levelId:"",pickupType:"plant",spawnTime:"10",type:"plant"},{tid:"1499274406460",x:1191,y:577,sprite:"plant",levelId:"",pickupType:"plant",spawnTime:"10",type:"plant"},{tid:"1500409157283",x:379,y:177,sprite:"duck",levelId:"",pickupType:"duck",type:"duck"},{tid:"1500409279208",x:1106,y:562,sprite:"giantCentipede",levelId:"",pickupType:"giantCentipede",type:"giantCentipede"}],persons:[{tid:"1499274340985",x:593,y:167,sprite:"witch2",levelId:"",questMessage:"Thank you for helping!"}],patients:[],blockers:[],slopes:[],bgs:[]},{levelId:"1496427681086",groundY:"100",groundSprite:"ground1",bgSprite:"",levelName:"Bana 3",ladders:[{tid:"1497386994753",x:597,y:592,sprite:"ladder1",levelId:"",direction:"down"}],platforms:[{tid:"1497387810727",x:640,y:594,sprite:"platform1",levelId:""},{tid:"1497387822124",x:89,y:770,sprite:"platform1",levelId:""
}],portals:[{tid:"1497387889691",x:580,y:861,sprite:"portal",levelId:"123",leads:"down",offset:!0,stretch:!0},{tid:"1497730153541",x:3,y:-2,sprite:"portal",levelId:"123",leads:"left",offset:!0,stretch:!0}],pickups:[{tid:"1497387842047",x:318,y:709,sprite:"amberCalcite",levelId:"",pickupType:"amberCalcite",spawnTime:"-1",type:"amberCalcite"},{tid:"1500410646265",x:1060,y:492,sprite:"foxglove",levelId:"",pickupType:"foxglove",type:"foxglove"},{tid:"1500410658787",x:978,y:533,sprite:"ravenGall",levelId:"",pickupType:"ravenGall",type:"ravenGall"},{tid:"1500410673108",x:886,y:535,sprite:"chamomile",levelId:"",pickupType:"chamomile",type:"chamomile"}],persons:[],patients:[],blockers:[],bgs:[]},{levelId:"1500237137016",groundY:"-600",noGround:!0,groundSprite:"ground1",bgSprite:"bg1-tent",levelName:"tent",ladders:[],platforms:[{tid:"1500238536835",x:367,y:429,sprite:"platform-tent",levelId:""}],portals:[{tid:"1500239015163",x:710,y:327,sprite:"door",levelId:"123",door:!0,spawnAtSprite:"1500237065908",leads:"right"}],pickups:[{tid:"1500241320627",x:378,y:269,sprite:"bearbile",levelId:"",pickupType:"bearbile",type:"bearbile"},{tid:"1500241556676",x:393,y:350,sprite:"batsBlood",levelId:"",pickupType:"batsBlood",spawnTime:"60",type:"batsBlood"},{tid:"1500325161145",x:546,y:365,sprite:"dragonsBlood",levelId:"",pickupType:"dragonsBlood",spawnTime:"-1",type:"dragonsBlood"},{tid:"1500410702762",x:435,y:357,sprite:"ravenGall",levelId:"",pickupType:"ravenGall",type:"ravenGall"},{tid:"1500410722068",x:820,y:415,sprite:"bearPaw",levelId:"",pickupType:"bearPaw",type:"bearPaw"}],persons:[{tid:"1505936497739",x:917,y:252,sprite:"witch3",levelId:"",questMessage:"Go away."}],patients:[],blockers:[],bgs:[{tid:"1500242406823",x:566,y:17,sprite:"lvl1-oven",levelId:""},{tid:"1500242425227",x:701,y:305,sprite:"lvl1-tentdoor",levelId:""},{tid:"1500324633674",x:374,y:334,sprite:"lvl1-tent-shelf",levelId:""},{tid:"1500324709846",x:487,y:394,sprite:"lvl1-tent-bottles",levelId:""},{tid:"1500324755795",x:856,y:391,sprite:"lvl1-tent-bottles2",levelId:""}]},{levelId:"1500634511430",groundY:"640",noGround:!1,groundSprite:"ground1",bgSprite:"bg1",levelName:"bana4",ladders:[{tid:"1500635001952",x:924,y:206,sprite:"ladder1",levelId:""}],platforms:[{tid:"1500635035566",x:449,y:244,sprite:"platform1",levelId:""}],portals:[{tid:"1500634665993",x:1360,y:541,sprite:"portal",levelId:"123",leads:"right",offset:!0,stretch:!0},{tid:"1500635608127",x:4,y:538,sprite:"portal",levelId:"1500635465965",leads:"left",offset:!0,stretch:!0}],pickups:[{tid:"1500634958506",x:380,y:562,sprite:"dogRose",levelId:"",pickupType:"dogRose",type:"dogRose"},{tid:"1500635324558",x:567,y:189,sprite:"amethyst",levelId:"",pickupType:"amethyst",spawnTime:"28",type:"amethyst"},{tid:"1500635368881",x:488,y:177,sprite:"heather",levelId:"",pickupType:"heather",type:"heather"}],persons:[],patients:[{tid:"1500634704579",x:268,y:614,sprite:"patient1",levelId:"",hideTid:"1500634726437",enemy:"cold",lives:"50",reward:"duck",rewardQty:"10",saveMessage:"Thank you! You saved me from that terrible disease. I give you 10 ducks."},{tid:"1500635047727",x:639,y:220,sprite:"patient1",levelId:"",enemy:"flu",lives:"50",reward:"dogRose",saveMessage:"Thank you for saving me! Here is 10 dog roses.",rewardQty:"10"}],blockers:[{tid:"1500634726437",x:11,y:416,sprite:"rock1",levelId:""}],bgs:[]},{levelId:"1500635465965",groundY:"640",noGround:!1,groundSprite:"ground1",bgSprite:"bg1b",levelName:"bana5",ladders:[{tid:"1500639053652",x:650,y:275,sprite:"ladder1",levelId:"",direction:"up"}],platforms:[],portals:[{tid:"1500635581353",x:1362,y:540,sprite:"portal",levelId:"1500634511430",leads:"right",offset:!0,stretch:!0},{tid:"1500635690823",x:405,y:539,sprite:"door",levelId:"1500635746745",leads:"left",stretch:!1,spawnAtSprite:"1500635886769",door:!0}],pickups:[],persons:[],patients:[],blockers:[{tid:"1500635545095",x:11,y:415,sprite:"rock1",levelId:""}],bgs:[{tid:"1500635644103",x:242,y:295,sprite:"tent1",levelId:""}]},{levelId:"1500635746745",groundY:"-1000",noGround:!0,groundSprite:"ground1",bgSprite:"bg1-tent",levelName:"tent2",ladders:[],platforms:[{tid:"1500635809146",x:382,y:482,sprite:"platform-tent",levelId:""}],portals:[{tid:"1500635886769",x:734,y:382,sprite:"door",levelId:"1500635465965",leads:"right",door:!0,spawnAtSprite:"1500635690823"}],pickups:[{tid:"1500638346009",x:420,y:417,sprite:"batsBlood",levelId:"",pickupType:"batsBlood",type:"batsBlood"},{tid:"1500638363625",x:970,y:463,sprite:"snail",levelId:"",pickupType:"snail",type:"snail"},{tid:"1500638366359",x:462,y:420,sprite:"ravenGall",levelId:"",pickupType:"ravenGall",type:"ravenGall"},{tid:"1500638568109",x:518,y:416,sprite:"dragonsBlood",levelId:"",pickupType:"dragonsBlood",type:"dragonsBlood"},{tid:"1500638570471",x:679,y:415,sprite:"dragonsBlood",levelId:"",pickupType:"dragonsBlood",type:"dragonsBlood"}],persons:[],patients:[],blockers:[],bgs:[{tid:"1500635839363",x:518,y:72,sprite:"lvl1-oven",levelId:""},{tid:"1500635871312",x:725,y:351,sprite:"lvl1-tentdoor",levelId:""}]}];BasicGame.MainMenu=function(a){this.music=null,this.playButton=null},BasicGame.MainMenu.prototype={create:function(a){var b;audioplayer.playMusic(),medicmenu.init(),a.stage.backgroundColor="#dddddd",b=this.add.sprite(this.world.centerX,this.world.centerY,"loadscreen1"),b.width=Utils.ScreenUtils.screenMetrics.maxGameWidth,b.height=Utils.ScreenUtils.screenMetrics.maxGameHeight,b.anchor.setTo(.5,.5),medicmenu.eventHub.$on("startnewgame",function(){brew.itemStore.state.items=[],brew.recipeStore.state.recipes=[],progressLog.graves=[],progressLog.destroyedSprites=[],progressLog.revealedSprites=[],pickupLog=[],brew.scoreStore.dispatch("importState",{life:3,level:1,xp:0}),brew.itemStore.dispatch("resetStore"),this.state.start("Game"),brew.eventHub.$emit("showTopMenu")}.bind(this)),medicmenu.eventHub.$on("continue",function(){var a=localStorage.getItem("medic-save");a&&(savedObj=JSON.parse(atob(a)),brew.scoreStore.dispatch("importState",savedObj.score),brew.itemStore.state.items=savedObj.items,brew.recipeStore.state.recipes=savedObj.recipes,progressLog.graves=savedObj.progressLog.graves,progressLog.destroyedSprites=savedObj.progressLog.destroyedSprites,progressLog.revealedSprites=savedObj.progressLog.revealedSprites,pickupLog=savedObj.pickupLog,this.state.start("Game",!0,!1,{resuming:!0,level:savedObj.currentLevel,x:savedObj.playerHitAreaX,y:savedObj.playerHitAreaY}),console.log("continue"),brew.eventHub.$emit("showTopMenu"))}.bind(this))},update:function(){},startGame:function(a){this.state.start("Game"),brew.eventHub.$emit("showTopMenu")}},BasicGame.Preloader=function(a){this.background=null,this.preloadBar=null,this.ready=!1},BasicGame.Preloader.prototype={preload:function(){localStorage.getItem("medic-levels")?(console.warn("Preloading from local storage"),levels=JSON.parse(localStorage.getItem("medic-levels"))):console.warn("Preloading from file");var a=this.add.sprite(this.world.centerX,this.world.centerY,"loadscreen1");a.width=Utils.ScreenUtils.screenMetrics.maxGameWidth,a.height=Utils.ScreenUtils.screenMetrics.maxGameHeight,a.anchor.setTo(.5,.5),this.preloadBar=this.add.sprite(this.world.centerX-175,630,"preloaderBar"),this.load.setPreloadSprite(this.preloadBar);for(var b=[],c=["ladders","patients","persons","pickups","platforms","portals","blockers","slopes","bgs","savepoints"],d=0;d<levels.length;d++){b.indexOf(levels[d].bgSprite)===-1&&levels[d].bgSprite&&b.push(levels[d].bgSprite),b.indexOf(levels[d].groundSprite)===-1&&levels[d].groundSprite&&b.push(levels[d].groundSprite);for(var e=0;e<c.length;e++){var f=c[e];if(levels[d][f]&&levels[d][f].length)for(var g=0;g<levels[d][f].length;g++){var h=levels[d][f][g];b.indexOf(h.sprite)===-1&&h.sprite&&b.push(h.sprite)}}}for(var d=0;d<b.length;d++)this.load.image(b[d],"assets/images/"+b[d]+".png");this.load.spritesheet("player","assets/images/player-sheet.png",64,104),this.load.image("grave","assets/images/grave.png"),this.load.image("healinghand","assets/images/healinghand.png"),this.load.image("enemy1","assets/images/enemy1.png"),this.load.image("playerHitArea","assets/images/player-hitarea.png"),this.load.atlas("startButton","assets/images/btn-start.png","assets/images/btn-start.json"),audioplayer.preload(this)},create:function(){this.preloadBar.cropEnabled=!1,audioplayer.init(this)},update:function(){this.cache.isSoundDecoded("track1")&&0==this.ready&&(this.ready=!0,this.state.start("MainMenu"))}};var Utils=Utils||{};Utils={ScreenUtils:{screenMetrics:{windowWidth:0,windowHeight:0,defaultGameWidth:0,defaultGameHeight:0,maxGameWidth:0,maxGameHeight:0,gameWidth:0,gameHeight:0,scaleX:1,scaleY:1,offsetX:0,offsetY:0},calculateScreenMetrics:function(a,b,c){var d,e=0,f=0,g=window.innerWidth,h=window.innerHeight;(g<h&&"landscape"===c||h<g&&"portrait"===c)&&(d=g,g=h,h=d),"landscape"===c?(e=Math.round(1420*a/1280),f=Math.round(960*b/800)):(e=Math.round(960*a/800),f=Math.round(1420*b/1280));var i=1.6,j=g/h,k=0,l=0,m=0,n=0;j>i?(n=b,m=2*Math.ceil(n*j/2),m=Math.min(m,e),k=(m-a)/2,l=0):(m=a,n=2*Math.ceil(m/j/2),n=Math.min(n,f),k=0,l=(n-b)/2);var o=g/m,p=h/n;return this.screenMetrics={},this.screenMetrics.windowWidth=g,this.screenMetrics.windowHeight=h,this.screenMetrics.defaultGameWidth=a,this.screenMetrics.defaultGameHeight=b,this.screenMetrics.maxGameWidth=e,this.screenMetrics.maxGameHeight=f,this.screenMetrics.gameWidth=m,this.screenMetrics.gameHeight=n,this.screenMetrics.scaleX=o,this.screenMetrics.scaleY=p,this.screenMetrics.offsetX=k,this.screenMetrics.offsetY=l,this.screenMetrics}},onResize:function(){},onLoad:function(){window.addEventListener("resize",Utils.onResize),this.onResize()}},window.addEventListener("load",Utils.onLoad.bind(Utils));